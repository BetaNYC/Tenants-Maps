
<!DOCTYPE html>
<html>
    <head>
        <title>Tenants Map | CARTO</title>
        <meta name="viewport" content="initial-scale=1.0">
            <meta charset="utf-8">
            <link href="https://fonts.googleapis.com/css?family=Lato:400,600,700|Open+Sans:300,400,600" rel="stylesheet">
			<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Playfair+Display" />
            <!-- Include Leaflet -->
            <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
            <link href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" rel="stylesheet">
            <!-- Include CARTO.js -->
            <script src="https://libs.cartocdn.com/carto.js/v4.1.2/carto.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
            <link href="https://carto.com/developers/carto-js/examples/maps/public/style.css" rel="stylesheet">
			<link href="css/style.css" rel="stylesheet">
			<script type="text/javascript" src="scripts/main.js"></script>
    </head>
    
    <body>
        <div id="map"></div>

        <!-- title, legend, and search controls -->
		<aside class="toolbox_left">
			<div class="box">
				
				<!-- title -->
                <header>
                    <h1 class = "bold">Tenants Map</h1>
                </header>
				<div class="separator"></div>
				
				<!-- instructions -->
					<h4>Instructions</h4>
					<h5 class="lighter">Click on a feature for more information about the property's units, rent-stabilization, and housing complaints.</h5>
				<div class="separator"></div>
				
				<!-- legend -->
					<h4>Legend</h4>
					<div class="clearfix margin_bottom">
						<hr class="solid_line">
						<p class="legend-text"> (<em>black solid outline</em>) Contains rent-stabilized units according to <em>both</em> the Rent Guidelines Board and NYC Property Tax Bills.</p>
					</div>
					<div class="clearfix margin_bottom">
						<hr class="dashed_line"> <p class="legend-text"> (<em>black dased outline</em>) Contains rent-stabilized units according to <em>either</em> the Rent Guidelines Board or NYC Property Tax Bills. </p>
					</div>
					<div class="clearfix margin_bottom">
						<div class="gradient_box"></div><p class="legend-text">(<em>parcel color</em>) Tax lots are shaded according to the increasing number of housing-related 311 complaints made about the property since 2015 </p>
					</div>
				<div class="separator"></div>
				
				<!-- CD filter -->
					<h4>Filter to a community district.</h4>
					<ul class="actions">
						<label class="search_label">Community District:</label>
						<div class="select_cd">
							<select id="community_district">
								<option value="101">101</option>
								<option value="102">102</option>
								<option value="103">103</option>
								<option value="104">104</option>
								<option value="105">105</option>
								<option value="106">106</option>
								<option value="107">107</option>
								<option value="108">108</option>
								<option value="109">109</option>
								<option value="110">110</option>
								<option value="111">111</option>
								<option value="112">112</option>
							</select>
						<div class="select_arrow_cd"></div>
						</div>
						<input type="submit" value="Search" onclick="set_cd()">
					</ul>
				<div class="separator"></div>
				
				<!-- location search -->
					<h4>Search</h4>
						<input id="address" placeholder="Enter a Manhattan Address" onfocus="this.value=''" type="text" name="address" value="" class="search_bar"><br/>
						<input type="submit" value="Search" onclick="set_address()">
						<div id="no_results">
							<p>No results found.</p>
						</div>
					<a href="#" onclick="reset_map();" class="reset_map">Reset Map</a>
			</div>
		</aside>
		
		<aside class="toolbox">
			<div id="info_box" class="box clearfix">
				<!-- property and location info -->
				<div id="info"></div>
				
				<!-- rent-stabilized info -->
				<div id="rent_header"></div>
				<canvas id="units_chart"></canvas>
				<div id="rent_info"></div>
				
				<!-- 311 info -->
				<div id="311_info"></div>
				<canvas id="complaint_type_chart" height="300px"></canvas>
				<canvas id="complaint_year_chart"></canvas>
				
				<!-- source info -->
				<div id="source"></div>
				<a href="#" onclick="toggle_visibility('info_box');" class="close_button">Close Window</a>
			</div>
			<footer class="js-footer"></footer>
        </aside>
		
        
        <script>
			//set map view
			const map = L.map('map').setView([40.73, -74], 15);
            map.scrollWheelZoom.disable();
			
			//set basemap
            L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                        maxZoom: 18
            }).addTo(map);
			
			//connect to Carto
            const client = new carto.Client({
                apiKey: '0cdd88f5e816766aec13f416ec14b633e6ecb4b6',
                username: 'betanyc'
            });
			
			//store API key for later SQL queries
			var api_key = '0cdd88f5e816766aec13f416ec14b633e6ecb4b6';
			
			//query data source from Carto:
			//1. union four table representing each year of 311 housing complaints, counting the number of complaints at each bbl
			//2. select the bbl and sum the count of complaints for each bbl in the union-ed table
			//3. join 311 complaints with rent-stabilized data (which has already been joined with Pluto, RGB data, and John Krauss's tax data
			const source_rent = new carto.source.SQL(`
				WITH 
				o AS (
					(SELECT bbl, COUNT(*) number_complaints
					FROM   table_311_buzzfeed_projmap_after_20180101_1 GROUP BY bbl)
					UNION
					(SELECT bbl, COUNT(*) number_complaints
					FROM   table_311_buzzfeed_projmap_2017_18_1
					GROUP BY bbl)
					UNION
					(SELECT bbl, COUNT(*) number_complaints
					FROM   table_311_buzzfeed_projmap_2016_1
					GROUP BY bbl)
					UNION
					(SELECT bbl, COUNT(*) number_complaints
					FROM   table_311_buzzfeed_projmap_2015_16_1
					GROUP BY bbl)
				),
				m AS (
					SELECT bbl, SUM(number_complaints) complaints
					FROM o
					GROUP BY bbl
				)
				SELECT right_source.cartodb_id cartodb_id, right_source.the_geom_webmercator the_geom_webmercator, m.complaints, right_source.pluto_bbl, right_source.pluto_policeprct, right_source.rent_pdf_cartodb_id, right_source.rent_pdf_status1, right_source.rent_pdf_status2, right_source.rent_pdf_status3, right_source.pluto_cd, right_source.pluto_council, right_source.pluto_zipcode, right_source.pluto_firecomp, right_source.pluto_address, right_source.pluto_ownername, right_source.pluto_numfloors, right_source.pluto_unitsres, right_source.pluto_unitstotal, right_source.pluto_yearbuilt, right_source.pluto_histdist, right_source.pluto_landmark, right_source.krauss_cartodb_id, right_source.pluto_schooldist
				FROM m 
				RIGHT JOIN rent_stabilized_plus_tax_data AS right_source
				ON right_source.pluto_bbl = m.bbl
				WHERE right_source.pluto_unitsres > 0
				`);
			
			//Style the map
			const style_rent = new carto.style.CartoCSS(`
					#layer {
						polygon-fill: ramp([complaints], (#ffffb2, #fed976, #feb24c, #fd8d3c, #fc4e2a, #e31a1c, #b10026), jenks); //shade according to the number of 311 complaints
					  ::backline [rent_pdf_cartodb_id=null][krauss_cartodb_id=null]{
						line-color: #bcbcbc;
						line-opacity: 1;
						[zoom >= 17] {line-width: .75}
						[zoom < 17] {line-width: .5}
						[zoom < 16] {line-width: .25}
						[zoom < 15] {line-width: .1}
						[zoom < 14] {line-width: .05}
					  }
					  //if in both RGB and krauss dataset, outline in solid black
					  ::dashline [rent_pdf_cartodb_id!=null][krauss_cartodb_id!=null]{
						line-color: #000000;
						line-opacity: 1;
						[zoom >= 18] {line-width: 1.75}
						[zoom < 18] {line-width: 1.5}
						[zoom < 17] {line-width: 1}
						[zoom < 16] {line-width: .75}
						[zoom < 15] {line-width: .5}
						[zoom < 14] {line-width: .25}
					  }
					  //if in just RGB, outline in dashed black
					  ::dashline [rent_pdf_cartodb_id!=null][krauss_cartodb_id=null]{
						line-color: #000000;
						line-opacity: 1;
						line-dasharray: 5, 3;
						[zoom >= 18] {line-width: 1.75}
						[zoom < 18] {line-width: 1.5}
						[zoom < 17] {line-width: 1}
						[zoom < 16] {line-width: .75}
						[zoom < 15] {line-width: .5}
						[zoom < 14] {line-width: .25}
					  }
					  //if in just krauss, outline in dashed black
					  ::frontline [rent_pdf_cartodb_id=null][krauss_cartodb_id!=null]{
						line-color: #000000;
						line-opacity: 1;
						line-dasharray: 5, 3;
						[zoom >= 18] {line-width: 1.75}
						[zoom < 18] {line-width: 1.5}
						[zoom < 17] {line-width: 1}
						[zoom < 16] {line-width: .75}
						[zoom < 15] {line-width: .5}
						[zoom < 14] {line-width: .25}
					  }
					  
					}
					
            `);
			
            const layer_rent = new carto.layer.Layer(source_rent, style_rent, {featureOverColumns: ['pluto_bbl','pluto_ownername', 'pluto_address','rent_pdf_status1','rent_pdf_status2','rent_pdf_status3','pluto_cd','pluto_schooldist','pluto_council','pluto_zipcode','pluto_firecomp','pluto_policeprct','pluto_numfloors','pluto_unitsres','pluto_unitstotal','pluto_yearbuilt','pluto_histdist','pluto_landmark']});
			
			//add layer to map
			client.addLayer(layer_rent);
			
			//set pop-up content when hovering over a feature
			layer_rent.on('featureOver', featureEvent =>{
				let rent_popup_content = '';
				
				rent_popup_content += `<div class="widget">`;
				rent_popup_content += `<p class = "bold">${featureEvent.data.pluto_address}</p>`;
				popup.setContent(rent_popup_content);
				popup.setLatLng(featureEvent.latLng);
				if (!popup.isOpen()) {
					popup.openOn(map);
				}
			});
			
			//variables for charts
			var complaint_chart;
			var year_chart;
			var units_year_chart;
			
			//plug-in so that data labels appear on each dot of the line charts (the rent-stabilized units by year chart and the 311 complaints over time chart)
			//see: http://www.chartjs.org/samples/latest/advanced/data-labelling.html
			var LabelsPlugin = {afterDatasetsDraw: function(chart) {
					var ctx = chart.ctx;
					chart.data.datasets.forEach(function(dataset, i) {
						var meta = chart.getDatasetMeta(i);
						if (!meta.hidden) {
							meta.data.forEach(function(element, index) {
								// Draw the text in black, with the specified font
								ctx.fillStyle = 'rgb(100, 100, 100)';
								var fontSize = 10;
								var fontStyle = 'normal';
								var fontFamily = 'Helvetica Neue';
								ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);
								
								if (dataset.data[index] != null)
									dataNum = dataset.data[index];
								else
									dataNum = 0;
								// Just naively convert to string for now
								var dataString = dataNum.toString();
								// Make sure alignment settings are correct
								ctx.textAlign = 'center';
								ctx.textBaseline = 'middle';
								var padding = -15;
								var position = element.tooltipPosition();
								
								if (dataString != 0) {
									ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
								}
							});
						}
					});
				}}
			
			layer_rent.on('featureClicked', featureEvent => {
				//variables for the innerHTML content that will be filled into each div in the infobox
				let content = '';
				let content_rent_header = '';
				let content_rent = '';
				let content_311 = '';
				let source = '';
				
				//property data
				content += `<h3 class = "bold">${featureEvent.data.pluto_address}</h3>
				<div class="separator"></div>
				<h4 class = "lighter">Property Information</h4>
				<h6 class = "lighter">BBL: ${featureEvent.data.pluto_bbl}</h5>
				<h6 class = "lighter">Owner Name: ${featureEvent.data.pluto_ownername}</h6>
				<h6 class = "lighter">Year Built: ${featureEvent.data.pluto_yearbuilt}</h6>
				<h6 class = "lighter">Residential Units: ${featureEvent.data.pluto_unitsres} of ${featureEvent.data.pluto_unitstotal}</h6>
				<h6 class = "lighter">Number of Floors: ${featureEvent.data.pluto_numfloors}</h6>`;
				//check if there is rent-stabilized data in RGB, and output it if so
				if (featureEvent.data.rent_pdf_status1 != '') {
					content += `<h6 class = "lighter">Rent Stabilized Status: ${featureEvent.data.rent_pdf_status1}`;
					if (featureEvent.data.status2 != '')
						content += `, ${featureEvent.data.rent_pdf_status2}`;
					if (featureEvent.data.status3 != '')
						content += `, ${featureEvent.data.rent_pdf_status3}`;
					content += `</h6>`;
				}
				
				//neighborhood data
				content += `
				<div class="separator"></div>
				<h4 class = "lighter">Neighborhood Information</h4>
				<h6 class = "lighter">Community District: ${featureEvent.data.pluto_cd}</h6>
				<h6 class = "lighter">City Council District: ${featureEvent.data.pluto_council}</h6>
				<h6 class = "lighter">Police Precinct: ${featureEvent.data.pluto_policeprct}</h6>
				<h6 class = "lighter">Fire Company: ${featureEvent.data.pluto_firecomp}</h6>`;
				
				//check if in historic district or landmark and output if so
				if (featureEvent.data.pluto_histdist != '' && featureEvent.data.pluto_histdist != null)
					content += `<h6 class = "lighter">Historic District: ${featureEvent.data.pluto_histdist}</h6>`;
				if (featureEvent.data.pluto_landmark != '' && featureEvent.data.pluto_landmark != null)
					content += `<h6 class = "lighter">Landmark: ${featureEvent.data.pluto_landmark}</h6>`;
				
				//rent-stabilized info
				content_rent_header += `<div class="separator"></div>
					<h4 class = "lighter">Rent-Stabilized Units</h4>`;
				
				//query john krauss's tax data (stored in Carto) for all entries with the bbl of the selected unit; select the number of units stabilized for each year
				var percent_change = 0;
				var url_tax = "https://betanyc.carto.com/api/v2/sql/?q=SELECT cartodb_id, _2007uc, _2008uc, _2009uc, _2010uc, _2011uc, _2012uc, _2013uc, _2014uc, _2015uc, _2016uc FROM john_krauss_tax_data WHERE ucbbl='"+featureEvent.data.pluto_bbl+"'&api_key="+api_key;
				fetch(url_tax)
				.then(function(response) {
					return response.json();
				})
				.then(function(tax_data) {
					//if there's data, clear and destroy previous chart
					if (tax_data.rows.length != 0 ) {
						if (typeof units_year_chart !== 'undefined'){
							units_year_chart.clear();
							units_year_chart.destroy();
						}
						
						//create rent-stabilized units per year line chart
						ctx3 = document.getElementById("units_chart").getContext('2d');
						units_year_chart = new Chart(ctx3, {
								type: 'line',
								plugins: LabelsPlugin,
								data: {
									labels: ["2007","2008","2009","2010","2011","2012","2013","2014","2015","2016"],
									
									datasets: [{
												data: [tax_data.rows[0]._2007uc, tax_data.rows[0]._2008uc, tax_data.rows[0]._2009uc, tax_data.rows[0]._2010uc, tax_data.rows[0]._2011uc, tax_data.rows[0]._2012uc, tax_data.rows[0]._2013uc, tax_data.rows[0]._2014uc, tax_data.rows[0]._2015uc, tax_data.rows[0]._2016uc],
												borderColor: '#175676'
											 }]
								},
								options: {
									legend: {
										display: false
									},
									scales: {
										yAxes: [{
											ticks: {
												beginAtZero:true,
												fontSize: 10
											},
											display: true,
											scaleLabel: {
												display: true,
												labelString: '# of Units',
												fontSize: 10
											}
										}],
										xAxes: [{
											ticks: {
												fontSize: 10
											},
											display: true,
											scaleLabel: {
												display: true,
												labelString: 'Year',
												fontSize: 10
											}
										}],
									},
									title: {
										display: false,
										text: 'Rent-Stabilized Units By Year'
									}
								}
							});
							//calculate the percent change in units between 2007 and 2016
							percent_change = ((tax_data.rows[0]._2016uc - tax_data.rows[0]._2007uc)/tax_data.rows[0]._2007uc)*100;
							if (percent_change != Infinity & percent_change != NaN){
								content_rent += `<h6 class = "lighter">% Change since 2007: ${percent_change.toFixed(2)}%</h6>`;
								console.log(percent_change);
							}
							
						}
						else {
							clear_rent_charts();
							content_rent += `<h6 class = "lighter">No Available Data</h6>`;
						}
						
				});
				
				//variables used to count the number of each complaint type at the selected bbl
				let heat = 0;
				let plumbing1 = 0;
				let plumbing2 = 0;
				let paint = 0;
				let rodent = 0;
				let general_construction = 0;
				let dirty_conditions = 0;
				let unsanitary_conditions = 0;
				let elevator = 0;
				
				//variables to store the years of complaints and number of complaints in that year for the selected bbl
				let year_arr = {};
				let year_labels = [];
				let year_data = [];
				
				//query each year of 311 housing data (stored in carto) at the selected bbl; select, complaint type and year
				var url_311 = "https://betanyc.carto.com/api/v2/sql/?q=SELECT cartodb_id, complaint_type, descriptor, created_date, EXTRACT(year from to_date(created_date, 'MM/DD/YYYY')) AS created_year FROM table_311_buzzfeed_projmap_2015_16_1 WHERE bbl='"+featureEvent.data.pluto_bbl+"' UNION SELECT cartodb_id, complaint_type, descriptor, created_date, EXTRACT(year from to_date(created_date, 'MM/DD/YYYY')) AS created_year FROM table_311_buzzfeed_projmap_2016_1 WHERE bbl='"+featureEvent.data.pluto_bbl+"' UNION SELECT cartodb_id, complaint_type, descriptor, created_date, EXTRACT(year from to_date(created_date, 'MM/DD/YYYY')) AS created_year FROM table_311_buzzfeed_projmap_2017_18_1 WHERE bbl='"+featureEvent.data.pluto_bbl+"' UNION SELECT cartodb_id, complaint_type, descriptor, created_date, EXTRACT(year from to_date(created_date, 'MM/DD/YYYY')) AS created_year FROM table_311_buzzfeed_projmap_after_20180101_1 WHERE bbl='"+featureEvent.data.pluto_bbl+"'&api_key="+api_key;
				let complaints_count = 0;
				fetch(url_311)
				.then(function(response) {
					return response.json();
				})
				.then(function(geom_data) {
					//count the total number of complaints from the returned data
					complaints_count = geom_data.rows.length;
					
					//calculate the number of complaints divided by the number of residential units in the building
					complaints_per_unit = geom_data.rows.length/featureEvent.data.pluto_unitsres;
					
					content_311 += `<div class="separator"></div>
					<h4 class = "lighter">311 Complaints</h4>
					<h6 class = "lighter">Total Number of Complaints: ${complaints_count}</h6>
					<h6 class = "lighter">Average Complaints Per Residential Unit: ${complaints_per_unit.toFixed(4)}</h6>`;
					
					//if there's data, clear and destroy previous charts
					if (complaints_count != 0) {
						if (typeof complaint_chart !== 'undefined'){
							complaint_chart.clear();
							complaint_chart.destroy();
						}
								 
						if (typeof year_chart !== 'undefined'){
							year_chart.clear();
							year_chart.destroy();
						}
						
						//count the number of each complaint type in the resulting data (I would have counted only unique complaints types here, but, in chart.js, in order to specify certain colors for certain labels, you need a stadard set of labels.)
						for (var i = 0; i < complaints_count; i++) {
							if (geom_data.rows[i].complaint_type == "HEAT/HOT WATER")
								heat++;
							else if (geom_data.rows[i].complaint_type == "PLUMBING")
								plumbing1++;
							else if (geom_data.rows[i].complaint_type == "PAINT/PLASTER")
								paint++;
							else if (geom_data.rows[i].complaint_type == "Plumbing")
								plumbing2++;
							else if (geom_data.rows[i].complaint_type == "Rodent")
								rodent++;
							else if (geom_data.rows[i].complaint_type == "Dirty Conditions")
								dirty_conditions++;
							else if (geom_data.rows[i].complaint_type == "General Construction/Plumbing")
								general_construction++;
							else if (geom_data.rows[i].complaint_type == "UNSANITARY CONDITIONS")
								unsanitary_conditions++;
							else if (geom_data.rows[i].complaint_type == "Elevator")
								elevator++;
						}
						
						//create bar chart of complaint types
						ctx = document.getElementById("complaint_type_chart").getContext('2d');
						complaint_chart = new Chart(ctx, {
							type: 'pie',
							data: {
								labels: ["HEAT/HOT WATER","PLUMBING","PAINT/PLASTER","Plumbing","Rodent","Dirty Conditions","General Construction/Plumbing","UNSANITARY CONDITIONS", "Elevator"],
								datasets: [{
											backgroundColor: ['#E31A1C','#FEB24C','#175676','#4BA3C3','#EC5766','#8D3B72','#0C0A3E','#00A878', '#f25c10'],
											borderWidth: 0,
											data: [heat, plumbing1,paint,plumbing2,rodent,dirty_conditions,general_construction, unsanitary_conditions, elevator]
										 }]
							},
							options: {
								title: {
									display: true,
									text: 'Complaints by Complaint Type'
								},
								legend: {
									display: true,
									labels: {
										fontSize: 10
									},
									position:'bottom',
									onClick: null,
									fullWidth: true
								}
							}
						});
					  
					   //store unique years in the resulting data in an array and count the number of complaints for each of those years
						for (var i = 0; i < complaints_count; i++) {
							year_arr[geom_data.rows[i].created_year] = 1 + (year_arr[geom_data.rows[i].created_year] || 0);
						}
						
						year_labels = Object.keys(year_arr);
						year_data = Object.values(year_arr);
						
						//create line chart of complaints per year
						ctx2 = document.getElementById("complaint_year_chart").getContext('2d');
						year_chart = new Chart(ctx2,{
							type: 'line',
							plugins: LabelsPlugin,
							data: {
								labels: year_labels,
								datasets: [{
									data: year_data,
									borderColor: '#175676'
								}]
							},
							options: {
								legend: {
									display: false
								},
								scales: {
									yAxes: [{
										ticks: {
											beginAtZero:true,
											fontSize: 10
										},
										display: true,
										scaleLabel: {
											display: true,
											labelString: '# of Complaints',
											fontSize: 10
										}
									}],
									xAxes: [{
										ticks: {
											fontSize: 10
										},
										display: true,
										scaleLabel: {
											display: true,
											labelString: 'Year',
											fontSize: 10
										}
									}],
								},
								title: {
									display: true,
									text: 'Complaints by Year'
								}
							}
						});
						//add source information
						source += `<div class="separator"></div><h6>Source: <a href='https://data.cityofnewyork.us/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9/data'>311 Service Requests from 2010 to Present</a></h6><h6>Data was filtered to housing-related complaint types (listed in legend above)  made since January 1, 2015. Data is updated daily.</h6><h6>Source: <a href='https://www1.nyc.gov/site/rentguidelinesboard/resources/rent-stabilized-building-lists.page'>Rent Guidelines Board Rent Stabilized Building Lists</a></h6><h6>Data is updated annually.</h6><h6>Source: <a href='https://webapps.nyc.gov/CICS/fin1/find001i'>Department of Finance Property Tax Bills</a></h6><h6>Data was <a href='http://taxbills.nyc/'>scraped</a> by civic hacker John Krauss.</h6><h6>Data is updated annually.</h6>`;
						
						//display the charts
						if (document.getElementById('complaint_type_chart').style.display = 'none')
							document.getElementById('complaint_type_chart').style.display = 'block';
						if (document.getElementById('complaint_year_chart').style.display = 'none')
							document.getElementById('complaint_year_chart').style.display = 'block';
					}
					
					//function to clear 311 charts
					else {
						clear_311_charts();
					}
					
				//set the info_box to display as block
				show_info_box();
				
				//fill the innerHTML of each section
				document.getElementById('info').innerHTML = content;
				document.getElementById('rent_header').innerHTML = content_rent_header;
				document.getElementById('rent_info').innerHTML = content_rent;
				document.getElementById('311_info').innerHTML = content_311;
				document.getElementById('source').innerHTML = source;
				});
			});
			
            client.getLeafletLayer().addTo(map);
            
            const popup = L.popup({ closeButton: false });
								
		</script>
    </body>
</html>
